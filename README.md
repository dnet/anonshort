AnonShort
=========

WIP, the functionality only consists of bootstrapping and random UA generation

License
-------

The whole project is licensed under MIT license.

Gathering User-Agents from NCSA (e.g. Apache) access logs
---------------------------------------------------------

Execute the following command in the directory where the logs are
(usually `/var/log/apache`).

	zcat -f * | egrep '(MSIE|Firefox|Safari)' | sed 's/^.*"\([^"]*\)"$/\1/' \
		| egrep -iv '(bot|spider|gfe)' | sort | uniq -c >agents.txt

The first command, `zcat` decompresses gzipped files, the `-f` parameter
makes it ignore uncompressed files. In the next step, mostly real browsers
get filtered, then the last field of the log (User-Agent) gets selected.
There are still some bots (even Google) using UA string that contain strings
like MSIE, so a second egrep filters everything else, then it gets sorted,
so `uniq` can do its task. In the end, you'll have a txt file, that contains
every unique User-Agent your HTTPd encountered and the number of hits
generated by that UA.

There's one step left, converting the textual representation to a SQLite
database, which is faster to query. Execute the following command.

	python agents2db.py agents.txt agents.db

It should take less than ten seconds, and if everything went well, you'll have
a nice `agents.db` file, that contains all the UAs and is fast to query. You
can test it by running the following command, which should print a single
random User-Agent string.

	python random_agent.py agents.db

Gathering browser signatures
----------------------------

Capture the TCP stream generated by each browser to be added, and save them in
separate files in the `bootstrap/browser-sigs` directory. I used Wireshark,
which is one of the easiest methods.

 - Set the capture filter to `tcp port 80`, this will minimize the noise.
 - Start the capture and open a URL in the browser.
 - Stop the capture after the page loaded, and select the first packet, that
   has the Path part of the URL in the description field.
 - Right click, and select Follow TCP stream.
 - In the new window, there's an option to save the whole stream in a file.

From this point, it's pretty easy: just `cd bootstrap/browser-sigs` and issue
a `make` command which should convert your bin file(s) into tpl file(s). You
might also need to edit the `transform.sed` file there, to match the locale
specific values used by your browser. (The current values assume an English
or Hungarian browser.)

Dependencies
------------

 - Python 2.6+ (tested on 2.6 and 2.7)
